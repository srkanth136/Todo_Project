#!/usr/bin/env bash
set -e
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

MAVEN_DIR="$SCRIPT_DIR/.mvn/apache-maven"
MAVEN_BIN="$MAVEN_DIR/bin/mvn"

if [ ! -x "$MAVEN_BIN" ]; then
  echo "Local Maven not found â€” downloading..."
  # try to use curl or wget
  ZIP_TMP="/tmp/maven-bin.zip"
  URL="https://archive.apache.org/dist/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.zip"
  if command -v curl >/dev/null 2>&1; then
    curl -sSL "$URL" -o "$ZIP_TMP"
  else
    wget -qO "$ZIP_TMP" "$URL"
  fi
  mkdir -p "$SCRIPT_DIR/.mvn"
  unzip -q "$ZIP_TMP" -d "$SCRIPT_DIR/.mvn"
  rm -f "$ZIP_TMP"
  # rename extracted directory to apache-maven
  EXTRACTED=$(ls "$SCRIPT_DIR/.mvn")
  mv "$SCRIPT_DIR/.mvn/$EXTRACTED" "$MAVEN_DIR" || true
fi

exec "$MAVEN_BIN" "$@"
